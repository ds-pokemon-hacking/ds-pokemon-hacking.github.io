"use strict";(self.webpackChunkkodsh_wiki_new=self.webpackChunkkodsh_wiki_new||[]).push([[1641],{4860:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/pt_reusable_repel-9c50fa6d02564c91e847b79bb8579ac2.png"},25631:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"generation-iv/guides/pt-reusable_repel/pt-reusable_repel","title":"Reusable Repel","description":"Author: SpagoAsparago","source":"@site/docs/generation-iv/guides/pt-reusable_repel/pt-reusable_repel.md","sourceDirName":"generation-iv/guides/pt-reusable_repel","slug":"/generation-iv/guides/pt-reusable_repel/","permalink":"/docs/generation-iv/guides/pt-reusable_repel/","draft":false,"unlisted":false,"editUrl":"https://github.com/ds-pokemon-hacking/ds-pokemon-hacking.github.io/docs/generation-iv/guides/pt-reusable_repel/pt-reusable_repel.md","tags":[{"inline":true,"label":"Guide (Platinum)","permalink":"/docs/tags/guide-platinum"}],"version":"current","frontMatter":{"title":"Reusable Repel","tags":["Guide (Platinum)"]},"sidebar":"generation_iv_sidebar","previous":{"title":"Overworld Sprite Replacement Guide","permalink":"/docs/generation-iv/guides/overworld_sprites/"},"next":{"title":"Optimizing and Expanding Functionality for Trainer Pokemon","permalink":"/docs/generation-iv/guides/pt-trainer_code_expansion/"}}');var i=t(74848),s=t(28453);const o={title:"Reusable Repel",tags:["Guide (Platinum)"]},l="Reusable Repel(Platinum)",a={},d=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"DSPRE",id:"dspre",level:2},{value:"Scripting",id:"scripting",level:3},{value:"Text",id:"text",level:3},{value:"Hex Editing",id:"hex-editing",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components},{Details:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsxs)(n.h1,{id:"reusable-repelplatinum",children:["Reusable Repel",(0,i.jsx)("sup",{children:(0,i.jsx)(n.em,{children:"(Platinum)"})})]})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Author: SpagoAsparago ",(0,i.jsx)("br",{}),"\nCredits: SpagoAsparago (Implementation), BluRose (Help with ASM), brahulus (Repel AR Code)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This is a tutorial on how to implement the reusable repel in Platinum.\nWhen the repel runs out, a prompt will appear, from which the player can choose to use another repel:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:t(4860).A+"",width:"256",height:"190"})}),"\n",(0,i.jsx)(n.p,{children:"The options only appear if the player has the appropriate repel item(s) in the bag"}),"\n",(0,i.jsxs)(n.p,{children:["You'll need to use ",(0,i.jsx)(n.a,{href:"https://github.com/AdAstra-LD/DS-Pokemon-Rom-Editor/releases",children:"DSPRE"})," and a Hex Editor. If you don't know how to hex edit, check out the ",(0,i.jsx)(n.a,{href:"/docs/universal/guides/hex_editing/",children:"Hex Editing Guide"})]}),"\n",(0,i.jsxs)(n.p,{children:["This ",(0,i.jsx)(n.strong,{children:"only works on the US Version of the game"}),". Attempting to replace the same bytes on a different language game will not work."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#dspre",children:"DSPRE"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#scripting",children:"Scripting"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#text",children:"Text"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#hex-editing",children:"Hex Editing"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"dspre",children:"DSPRE"}),"\n",(0,i.jsxs)(n.p,{children:["If you don't have one already, create a new project by loading your ROM in DSPRE. Then go to the ",(0,i.jsx)(n.em,{children:"Scripting"})," tab."]}),"\n",(0,i.jsx)(n.h3,{id:"scripting",children:"Scripting"}),"\n",(0,i.jsxs)(n.p,{children:["Go to ",(0,i.jsx)(n.code,{children:"Script 33"})," replace it with the following:"]}),"\n",(0,i.jsxs)(r,{children:[(0,i.jsx)("summary",{children:"Script 33"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Script 33:\n\tPlayFanfare 1500\n\tLockAll\n  CheckPlayerHasItem 79 1 0x800C\n\tCompareVarValue 0x800C 1\n\tJumpIf EQUAL Function#177\n\tCheckPlayerHasItem 76 1 0x800C\n\tCompareVarValue 0x800C 1\n\tJumpIf EQUAL Function#177\n\tCheckPlayerHasItem 77 1 0x800C\n\tCompareVarValue 0x800C 1\n\tJumpIf EQUAL Function#177\n\tMessage 79\n\tWaitAB\n\tCloseMessage\n\tReleaseAll\nEnd\n"})})]}),"\n",(0,i.jsxs)(n.p,{children:["Next go to the ",(0,i.jsx)(n.em,{children:"Functions"})," tab and add the following functions. If the functions 177+ already exist, adjust the new function IDs accordingly so that no functions are replaced."]}),"\n",(0,i.jsxs)(r,{children:[(0,i.jsx)("summary",{children:"Functions"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Function 177:\n  Message 75\n\tYesNoBox 0x800C\n\tCompareVarValue 0x800C 0\n\tJumpIf EQUAL Function#178\n\tCloseMessage\n\tReleaseAll\nEnd\n\nFunction 178:\n  CloseMessage\n\tMultiStandardText 1 1 0 1 0x800C\n\tCheckPlayerHasItem 79 1 0x8000\n\tCompareVarValue 0x8000 1\n\tCallIf EQUAL Function#179\n\tCheckPlayerHasItem 76 1 0x8000\n\tCompareVarValue 0x8000 1\n\tCallIf EQUAL Function#180\n\tCheckPlayerHasItem 77 1 0x8000\n\tCompareVarValue 0x8000 1\n\tCallIf EQUAL Function#181\n\tShowMulti\n\tCompareVarValue 0x800C 0\n\tJumpIf EQUAL Function#182\n\tCompareVarValue 0x800C 1\n\tJumpIf EQUAL Function#183\n\tCompareVarValue 0x800C 2\n\tJumpIf EQUAL Function#184\n\tReleaseAll\nEnd\n\nFunction 179:\n    AddMultiOption 30 0\nReturn\n\nFunction 180:\n    AddMultiOption 31 1\nReturn\n\nFunction 181:\n    AddMultiOption 32 2\nReturn\n\nFunction 182:\n  AdrsValueSet 0x023DFF28 100\n\tDummyTakeTrap\n  TakeItem 79 1 0x8000\n\tTextPlayerName 0\n\tTextItem 1 79\n\tMessage 72\n\tWaitButton\n\tCloseMessage\nReturn\n\nFunction 183:\n    AdrsValueSet 0x023DFF28 150\n\tDummyTakeTrap\n    TakeItem 76 1 0x8000\n\tTextPlayerName 0\n\tTextItem 1 76\n\tMessage 72\n\tWaitButton\n\tCloseMessage\nReturn\n\nFunction 184:\n  AdrsValueSet 0x023DFF28 250\n\tDummyTakeTrap\n  TakeItem 77 1 0x8000\n\tTextPlayerName 0\n\tTextItem 1 77\n\tMessage 72\n\tWaitButton\n\tCloseMessage\nReturn\n"})})]}),"\n",(0,i.jsx)(n.p,{children:"Save the script file."}),"\n",(0,i.jsx)(n.h3,{id:"text",children:"Text"}),"\n",(0,i.jsxs)(n.p,{children:["Go to the ",(0,i.jsx)(n.em,{children:"Text Editor"})," tab. Remember to save each Text Archive before moving on to the next one."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Open ",(0,i.jsx)(n.code,{children:"Text Archive 361"}),", and replace messages 30, 31 and 32 respectively with:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Repel"}),"\n",(0,i.jsx)(n.li,{children:"Super Repel"}),"\n",(0,i.jsx)(n.li,{children:"Max Repel"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Open ",(0,i.jsx)(n.code,{children:"Text Archive 213"}),", and replace message 72 with:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.em,{children:"Repel\u2019s effect wore off...\\nWould you like to use another one?"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Open ",(0,i.jsx)(n.code,{children:"Text Archive 213"}),", and replace message 75 with:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.em,{children:"\\v0103\u3041\\x0000\\x0000 used the\\n\\v0108\u3041\\x0001\\x0000.\\rWild Pok\xe9mon will be repelled."})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"hex-editing",children:"Hex Editing"}),"\n",(0,i.jsxs)(n.p,{children:["If you haven't already, you need to expand the arm9 trough DSPRE's ROM Toolbox. You can do so by clicking the Explorer Kit Icon in the top bar and applying the ",(0,i.jsx)(n.em,{children:"ARM9 Expansion"})," patch."]}),"\n",(0,i.jsxs)(n.p,{children:["In the folder where your ROM is located, DSPRE should have created a folder name yourROMname_DSPRE_Contents. Inside that you'll find a file called ",(0,i.jsx)(n.code,{children:"arm9.bin"}),", open it in your hex editor of choice."]}),"\n",(0,i.jsxs)(n.p,{children:["Go to the offset ",(0,i.jsx)(n.code,{children:"0x4EAE8"})," and replace all the bytes from this offset with the following sequence:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"0B 48 01 68 0B 48 09 18 0B 48 02 78 0A 70 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 C0 46 70 47 40 1D 10 02 87 80 00 00 28 FF 3D 02\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Do ",(0,i.jsx)(n.strong,{children:"not"})," add new bytes. In HxD you can paste without replacing with the Ctrl+B shortcut. Save the file."]}),"\n",(0,i.jsxs)(n.p,{children:["Now you can load DSPRE again and save the ROM. Remember to ",(0,i.jsx)(n.strong,{children:"not"})," re-extract the contents, otherwise your hex editing will be lost!"]}),"\n",(0,i.jsx)(n.p,{children:"The custom command works by setting the repel counter at the byte written at 15FEE in weather_sys_9.bin, so remember to don't write anything at this offset!"}),"\n",(0,i.jsxs)(r,{children:[(0,i.jsx)("summary",{children:"Detailed Explanation for the Custom Command and Repel Counter"}),(0,i.jsx)(n.p,{children:"The repel counter is a dynamic offset located at (Address at 0x02101D40) + (0x8087). This is only valid for the US version, hence my code won't work on other regions without writing a new custom command."}),(0,i.jsx)(n.p,{children:"When the repel counter runs out, the game will automatically execute Script 33 in Script File 211."}),(0,i.jsx)(n.p,{children:"After the scripting and hex edits performed, now Script 33 will:"}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Check if the player has any repel item in their bag"}),"\n",(0,i.jsx)(n.li,{children:"If they do, ask if they wants to use anothe repel"}),"\n",(0,i.jsx)(n.li,{children:"If they want to, create a popup window containing all the available repel items"}),"\n",(0,i.jsx)(n.li,{children:"Remove the repel item that has been chosen from the bag"}),"\n",(0,i.jsxs)(n.li,{children:["Use the ",(0,i.jsx)(n.code,{children:"AdrsValueSet"})," command to write a byte at the offset 0x023DFF28, containing the number of steps of the selected repel"]}),"\n",(0,i.jsxs)(n.li,{children:["Trough the ",(0,i.jsx)(n.code,{children:"DummyTakeTrap"}),", the repel counter is increased by the previously set value"]}),"\n"]}),(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"DummyTakeTrap"})," command is otherwise unused, so it's been replaced with a custom one in order to access the dynamic offset of the repel counter, and set the counter to the new value.\nThe custom command is necessary as there is no way to access the dynamic offset using only vanilla scripting commands.\nThis is the raw assembly code:"]}),(0,i.jsxs)(r,{children:[(0,i.jsx)("summary",{children:"ASM Code"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"ldr r0, =0x02101D40\nldr r1, [r0]\nldr r0, =0x8087\nadd r1, r0\nldr r0, =0x023DDFEE\nldrb r2, [r0]\nstrb r2, [r1]\nnop\nnop\nnop\nnop\nnop\nnop\nnop\nnop\nnop\nnop\nnop\nnop\nnop\nnop\nnop\nnop\nbx lr\n"})})]}),(0,i.jsx)(n.p,{children:"This part of the code:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"ldr r0, =0x02101D40\nldr r1, [r0]\nldr r0, =0x8087\nadd r1, r0\n"})}),(0,i.jsx)(n.p,{children:"Is used to calculate the dynamic offset by loading the address at 0x2101D40 and then adding 0x8087 to it, storing the repel counter offset in the R1 register."}),(0,i.jsx)(n.p,{children:"The following part:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"ldr r0, =0x023DDFEE\nldrb r2, [r0]\nstrb r2, [r1]\n"})}),(0,i.jsxs)(n.p,{children:["Is used to read the byte previously written at 0x023DDFEE by the ",(0,i.jsx)(n.code,{children:"AdrsValueSet"})," command, and updating the repel counter with it.\nThe 0x023DDFEE offset is at a region in the RAM otherwise unused, but costantly loaded trough the syntehtic overlay."]}),(0,i.jsxs)(n.p,{children:["The remaining ",(0,i.jsx)(n.code,{children:"nop"})," commands are there to maintain the original command dimension and prevent the script command table from being read incorrectly."]})]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var r=t(96540);const i={},s=r.createContext(i);function o(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);